<?php/* * --------------------------------------------- * Author : dtoan * Email  : ghostkissboy12@gmail.com * Company listing * --------------------------------------------- */ class CompanyController extends MemberController {    public $userID;    public function init() {        parent::init();        $this->userID = Yii::app()->user->id;    }    public function actionIndex() {        $this->pageTitle ='Companys Listing' .' - '.Yii::app()->params['title'];        $model = new Listing();        $model->unsetAttributes();          if(isset($_GET['Listing']))            $model->attributes=$_GET['Listing'];           $this->render('index', array('model' => $model));    }    public function actionView($id) {         $this->pageTitle ='View Listing detail' .' - '.Yii::app()->params['title'];        $model = $this->loadModel($id);        $this->render('view', array('model' => $model));    }    public function loadModel($id) {        $model = ListingCompany::model()->findByPk($id);        if ($model === null) {            throw new CHttpException(404, 'The requested page does not exist.');        }        return $model;    }	public function actionFieldClick($id, $field) {		$model = Listing::model()->findByPk($id);		if (!$model || !in_array($field, array('owner_contact')) )			throw new CHttpException(403, 'Permission denied.');				$lc = ListingClick::model()->findByAttributes(array(			'listing_id' => $id,			'user_id' => Yii::app()->user->id,			'field' => $field		));				if (!$lc) {			$lc = new ListingClick();			$lc->listing_id = $id;			$lc->user_id = Yii::app()->user->id;			$lc->field = $field;			$lc->save();		}				$f = $field.'_click';		$model->$f = count($model->getContactClickedUsers());		$model->update($f);		echo $model->$f;	}	public function actionSubmitTcForm() {		if (isset($_POST['CompanyListingAgreement'])) {			$model = new CompanyListingAgreement('show-popup');			$model->attributes = $_POST['CompanyListingAgreement'];			if ($model->save()) {				SendEmail::companyListingAgreementToAdmin($model);			}		}		$this->redirect(Yii::app()->request->urlReferrer);	}}