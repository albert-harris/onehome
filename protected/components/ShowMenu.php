<?phpclass ShowMenu {    /**     * return menu ul li.     */    public $str = "";    public function haschild($id, $arrobj) {        foreach ($arrobj as $obj)            if ($obj->parent_id == $id)                return 1;        return 0;    }//	public function findchild($id,$arrobj,$selected_id='',$userRoleMenuId=array())//	{//		foreach($arrobj as $obj)//		{//			$temp_id 		= $obj->id;//			$temp_parent_id = $obj->parent_id;//			if($temp_parent_id==$id)//			{//                                $name       = $obj->name;//                                //show menus not a parent//                                if(!$this->haschild($temp_id,$arrobj)==1)//                                {//                                    if($obj->type == 'page')//                                    {//                                        if($obj->required_login == 1)//                                        {//                                            if(!empty(Yii::app()->user->id))//                                                $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl("/page/" . $obj->page->slug)."'>$obj->name</a></li>";//                                            else//                                                $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl("site/login", array('returnUrl'=>"/page/" . $obj->page->slug))."'>$obj->name</a></li>";//                                        }//                                        else//                                            $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl("/page/" . $obj->page->slug)."'>$obj->name</a></li>";//                                    }//                                    elseif($obj->type == 'url')//                                    {//                                        if($obj->required_login == 1)//                                        {//                                            if(!empty(Yii::app()->user->id))//                                                $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl($obj->link)."'>$obj->name</a></li>";//                                            else//                                                $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl("site/login", array('returnUrl'=>$obj->link))."'>$obj->name</a></li>";//                                        }//                                        else//                                            $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl($obj->link)."'>$obj->name</a></li>";//                                    }//                                }//                                //                                //show menus is a parent                                             //                                if($this->haschild($temp_id,$arrobj)==1)//                                {//                                    if($obj->type == 'page')//                                    {//                                        if($obj->required_login == 1)//                                        {//                                            if(!empty(Yii::app()->user->id))//                                                $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl("/page/" . $obj->page->slug)."'>$obj->name</a><ul>";//                                            else//                                                $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl("site/login", array('returnUrl'=>"/page/" . $obj->page->slug))."'>$obj->name</a><ul>";//                                        }//                                        else//                                            $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl("/page/" . $obj->page->slug)."'>$obj->name</a><ul>";                                        //                                    }//                                    elseif($obj->type == 'url')//                                    {//                                        if($obj->required_login == 1)//                                        {//                                            if(!empty(Yii::app()->user->id))//                                                $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl($obj->link)."'>$obj->name</a><ul>";//                                            else//                                                $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl("site/login", array('returnUrl'=>$obj->link))."'>$obj->name</a><ul>";//                                        }//                                        else//                                            $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl($obj->link)."'>$obj->name</a><ul>";//                                    }//                                    $this->findchild($temp_id,$arrobj,$selected_id,$userRoleMenuId);//                                    $this->str.="</ul></li>";//                                }			//			}//		}//	}//	public function showMenu($place_holder_id = 0)//	{//            $value = '';//            $menus = FeMenus::model()->findAll(array(//                'condition'=>'status="1" AND place_holder_id=:place_holder_id',//                'params'=>array(':place_holder_id'=>$place_holder_id),//                'order'=>'`order` asc',//            ));//            $this->str="<ul id='navmenu'>";	//            $this->str.="<li><a href='".Yii::app()->createAbsoluteUrl('/')."'>Home</a></li>";		//            if($menus!= NULL)//            {			//                $this->findchild(0,$menus,$value);//            }		//            $this->str.="</ul>";//            return $this->str;//	}    public function findchild($id, $arrobj, $selected_id = '', $userRoleMenuId = array()) {        foreach ($arrobj as $obj) {            $temp_id = $obj->id;            $temp_parent_id = $obj->parent_id;            $link = '';//            $link .= Yii::app()->getBaseUrl(true);            $action = Yii::app()->controller->action->id;            $link = 'http://' . $_SERVER['SERVER_NAME'].$_SERVER['REQUEST_URI'];                       $active = '';                       if ($temp_parent_id == $id) {                $name = $obj->title;                if($obj->external_link != "") {                                        if (strtolower($obj->external_link) == strtolower($link)) {                        $active .= ' active';                    }                    $link_mn = $obj->external_link;                } else {                    if(isset($_GET['slug']) && $_GET['slug']!=""){                        if (strtolower($_GET['slug']) == strtolower($obj->slug)) {                            $active .= ' active';                        }                    }                    $link_mn = Yii::app()->createAbsoluteUrl('page/index',array('slug'=>$obj->slug));                                    }                //show menus not a parent                if (!$this->haschild($temp_id, $arrobj) == 1) {                    $this->str.="<li class='".$active."'><a href='" .$link_mn. "'>$obj->title</a></li>";                }                //show menus is a parent                                                             if ($this->haschild($temp_id, $arrobj) == 1) {                    $this->str.="<li class='".$active."'><a href='" .$link_mn. "'>$obj->title</a><ul>";                    $this->findchild($temp_id, $arrobj, $selected_id, $userRoleMenuId);                    $this->str.="</ul></li>";                }            }        }    }    public function showMenu($place_holder_id = 0) {        $value = '';        $criteria = new CDbCriteria;        $criteria->compare('t.status', 1);        $criteria->compare('t.show_home_page', 1);        $criteria->order = 't.order asc';        $menus = Pages::model()->findAll($criteria);        $this->str = "<ul id='menu' class='menu'>";        if ($menus != NULL) {            $this->findchild(0, $menus, $value);        }        $this->str.="</ul>";        return $this->str;    }    public function showMenu_footer() {        $value = '';        $criteria = new CDbCriteria;        $criteria->compare('t.status', 1);        $criteria->compare('t.show_footer', 1);        $criteria->order = 't.order asc';        $menus = Pages::model()->findAll($criteria);        $this->str = "<ul>";        if ($menus != NULL) {            foreach ($menus as $key=>$val){                if($val->external_link != "") {                    $link_mn = $val->external_link;                } else {                    $link_mn = Yii::app()->createAbsoluteUrl('page/index',array('slug'=>$val->slug));                }                                $this->str .= "<li><a href='".$link_mn."'>".$val->title;                $this->str .= "</a></li>";                $key = $key +1;                if((int)$key%4 == 0){                    $this->str .= "</ul><ul>";                }            }                    }        $this->str.="</ul>";        return $this->str;    }    //Kvan    public function showMenu_siteMap(){        $value = '';        $criteria = new CDbCriteria;        $criteria->compare('t.status', 1);        $criteria->compare('t.show_home_page', 1);        $criteria->order = 't.order asc';        $menus = Pages::model()->findAll($criteria);        $this->str = "<ul id='site-map'>";        if ($menus != NULL) {            $this->findchild(0, $menus, $value);        }        $this->str.="</ul>";        return $this->str;    }	/*	 * New main menu for responsive layout	 * 	 * @author Lam Huynh	 */	public function showNewMainMenu() {        $value = '';        $criteria = new CDbCriteria;        $criteria->compare('t.status', 1);        $criteria->compare('t.show_home_page', 1);        $criteria->order = 't.order asc';        $menus = Pages::model()->findAll($criteria);        $this->str = '<ul class="nav navbar-nav">';        if ($menus != NULL) {            $this->findNewChild(0, $menus, $value);        }        $this->str.="</ul>";        return $this->str;			}		/*	 * New menu builder for responsive layout	 * 	 * @author Lam Huynh	 */    public function findNewChild($id, $arrobj, $selected_id = '', $userRoleMenuId = array()) {        foreach ($arrobj as $obj) {            $temp_id = $obj->id;            $temp_parent_id = $obj->parent_id;            $link = '';            $action = Yii::app()->controller->action->id;            $link = 'http://' . $_SERVER['SERVER_NAME'].$_SERVER['REQUEST_URI'];            $active = '';            if ($temp_parent_id == $id) {                $name = $obj->title;                if($obj->external_link != "") {                    if (strtolower($obj->external_link) == strtolower($link)) {                        $active .= ' active';                    }                    $link_mn = $obj->external_link;                } else {                    if(isset($_GET['slug']) && $_GET['slug']!=""){                        if (strtolower($_GET['slug']) == strtolower($obj->slug)) {                            $active .= ' active';                        }                    }                    $link_mn = Yii::app()->createAbsoluteUrl('page/index',array('slug'=>$obj->slug));                                    }                //show menus not a parent                if (!$this->haschild($temp_id, $arrobj) == 1) {                    $this->str.="<li class='".$active."'><a href='" .$link_mn. "'>$obj->title</a></li>";                }                //show menus is a parent                                                             if ($this->haschild($temp_id, $arrobj) == 1) {                    $this->str.=sprintf('<li class="%s dropdown"> 						<a href="%s">%s</a>						<i class="fa fa-angle-down dropdown-toggle"						   data-toggle="dropdown" 						   role="button" aria-haspopup="true" 						   aria-expanded="false"						   >&nbsp;</i>						<ul class="dropdown-menu">', $active, $link_mn, $obj->title);                    $this->findNewChild($temp_id, $arrobj, $selected_id, $userRoleMenuId);                    $this->str.="</ul></li>";                }            }        }    }	/*	 * New footer menu for responsive layout	 * 	 * @author Lam Huynh	 */    public function showNewFooterMenu() {        $criteria = new CDbCriteria;        $criteria->compare('t.status', 1);        $criteria->compare('t.show_footer', 1);        $criteria->order = 't.order asc';        $menus = Pages::model()->findAll($criteria);		$this->str = '';        if ($menus != NULL) {            foreach ($menus as $key=>$val){                if ((int)$key%4 == 0){					$this->str .= '<div class="col-xs-6 col-sm-3 col-md-6"><ul class="list-unstyled">';                }                if($val->external_link != "") {                    $link_mn = $val->external_link;                } else {                    $link_mn = Yii::app()->createAbsoluteUrl('page/index',array('slug'=>$val->slug));                }                $this->str .= "<li><a href='".$link_mn."'>".$val->title;                $this->str .= "</a></li>";                if((int)$key%4 == 3 || $key==count($menus)-1){                    $this->str .= '</ul></div>';                }            }        }        $this->str.="</ul>";        return $this->str;    }}